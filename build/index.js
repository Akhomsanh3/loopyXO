"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function initialize(){for(var e=0;e<3;e++)for(var t=0;t<3;t++){var n=new fabric.Rect({top:e*oneThirdHeight,left:t*oneThirdWidth,height:oneThirdHeight-2,width:oneThirdWidth-2,fill:"",stroke:"white",selectable:!1,id:(count++).toString(),occupied:!1});rectangles.push(n)}rectangles.forEach(function(e){c.add(e)});var i=new fabric.Line([oneThirdWidth-2,0,oneThirdWidth-2,height],boardProps),o=new fabric.Line([2*oneThirdWidth-2,0,2*oneThirdWidth-2,height],boardProps),r=new fabric.Line([0,oneThirdHeight-2,width,oneThirdHeight-2],boardProps),a=new fabric.Line([0,2*oneThirdHeight-2,width,2*oneThirdHeight-2],boardProps);c.add(i,o,r,a),progress.style.animation="reduced "+playerTime+"s ease-in",progress.addEventListener("animationend",function(e){switchTurn(),cloneProgress(),repaint()}),startGame()}function startGame(){c.on("mouse:down",function(e){var t=rectangles.filter(function(t){if(t.id===e.target.id&&!e.target.occupied)return!0});t=t[0];var n=TURN,i=new fabric.Text(n,{left:t.left+t.width/2,top:t.top+t.height/2,fill:xAndOColor,fontSize:t.width/2,fontFamily:"Raleway",fontWeight:100,selectable:!1,originX:"center",originY:"center"});if(labels.push(i),rectangles.map(function(e){return e.id===t.id&&(e.occupied=!e.occupied),e}),cloneProgress(),i.animate("fontSize",t.width/1.87,{onChange:c.renderAll.bind(c),duration:100,oncomplete:c.renderAll()}),c.add(i),9===labels.length)return boardFull=!0,void repaint();areWeDoneHere("X"===TURN?xPosition:oPosition,t)?repaint():switchTurn()})}function repaint(){if(boardFull){labels.forEach(function(e){setTimeout(function(){c.remove(e)},100)}),rectangles.forEach(function(e){e.occupied=!1});var e=new fabric.Text("DRAW",{left:c.getCenter().left,top:c.getCenter().top,fill:xAndOColor,fontSize:gameOverTextSize,fontFamily:"Raleway",fontWeight:100,selectable:!1,originX:"center",originY:"center"});return c.add(e),setTimeout(function(){c.remove(e)},500),xPosition=[],oPosition=[],gameStatus=!1,labels=[],boardFull=!1,TURN="X",void cloneProgress()}if(labels.forEach(function(e){setTimeout(function(){c.remove(e)},100)}),rectangles.forEach(function(e){e.occupied=!1}),"X"===TURN){xScore++,xScorePlaceholder.innerText=xScore,xScoreContainer.classList.add("animated"),xScoreContainer.classList.add("shake");var t=new fabric.Text("X WON!",{left:c.getCenter().left,top:c.getCenter().top,fill:xAndOColor,fontSize:gameOverTextSize,fontFamily:"Raleway",fontWeight:100,selectable:!1,originX:"center",originY:"center"});c.add(t),setTimeout(function(){xScoreContainer.className="",c.remove(t)},500)}else{oScore++,oScorePlaceholder.innerText=oScore,oScoreContainer.classList.add("animated"),oScoreContainer.classList.add("shake");var n=new fabric.Text("O WON!",{left:c.getCenter().left,top:c.getCenter().top,fill:xAndOColor,fontSize:gameOverTextSize,fontFamily:"Raleway",fontWeight:100,selectable:!1,originX:"center",originY:"center"});c.add(n),setTimeout(function(){oScoreContainer.className="",c.remove(n)},500)}return xPosition=[],oPosition=[],gameStatus=!1,labels=[],TURN="X",void cloneProgress()}function areWeDoneHere(e,t){return e.push(parseInt(t.id)),WIN.some(function(t){var n=void 0;if(e.length>3)n=divideThemInChunks(e);else{if(3!==e.length)return!1;n=_.chunk(e,3)}return n.map(function(e){return e.sort()}),n.some(function(e){return gameStatus=0==_.difference(t,e).length}),gameStatus}),gameStatus}function divideThemInChunks(e){var t=[];return[].concat(_toConsumableArray(Array(e.length).keys())).forEach(function(n){var i=[].concat(_toConsumableArray(e)),o=_.pull(i,i[n]);t.push(o)}),_.uniq(t)}function switchTurn(){TURN="X"===TURN?"O":"X"}function cloneProgress(){var e=progress,t=e.cloneNode(!0);e.parentNode.replaceChild(t,e),t.addEventListener("animationend",function(e){e.preventDefault(),switchTurn(),cloneProgress(),repaint()})}var ismobile=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i),PADDING=ismobile?5*window.outerWidth/100:window.outerWidth/100;canvas.style.padding=ismobile?"5%":"1%";var playerTime=7,gameStatus=!1,gameOverTextSize=8*window.document.fonts.size,xScorePlaceholder=document.querySelector(".xScore"),oScorePlaceholder=document.querySelector(".oScore"),boardFull=!1,xScore=0,oScore=0,labels=[],xAndOColor="#FFC107",WIN=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],xPosition=[],oPosition=[],TURN="X",c=new fabric.Canvas("canvas",{width:window.innerWidth-2*PADDING,height:window.innerHeight-scorecard.offsetHeight-2.5*PADDING,selectable:!1}),boardProps={stroke:"#00bcd4",fill:"",strokeWidth:1,selectable:!1},height=canvas.clientHeight-PADDING,width=canvas.clientWidth-PADDING,oneThirdWidth=Math.floor(width/3),oneThirdHeight=Math.floor(height/3),rectangles=[],count=0;initialize();