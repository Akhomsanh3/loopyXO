"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}function startGame(){c.on("mouse:down",function(e){var n=rectangles.filter(function(n){if(n.id===e.target.id&&!e.target.occupied)return!0});n=n[0];var t=TURN,i=new fabric.Text(t,{left:n.left+n.width/2,top:n.top+n.height/2,fill:"pink",fontSize:n.width/2,fontFamily:"Raleway",fontWeight:100,selectable:!1,originX:"center",originY:"center"});if(labels.push(i),rectangles.map(function(e){return e.id===n.id&&(e.occupied=!e.occupied),e}),cloneProgress(),i.animate("fontSize",n.width/1.87,{onChange:c.renderAll.bind(c),duration:100,oncomplete:c.renderAll()}),c.add(i),9===labels.length)return boardFull=!0,void repaint();areWeDoneHere("X"===TURN?xPosition:oPosition,n)?repaint():switchTurn()})}function repaint(){if(boardFull){labels.forEach(function(e){setTimeout(function(){c.remove(e)},100)}),rectangles.forEach(function(e){e.occupied=!1});var e=new fabric.Text("DRAW",{left:c.getCenter().left,top:c.getCenter().top,fill:"hotpink",fontSize:100,fontFamily:"Raleway",fontWeight:100,selectable:!1,originX:"center",originY:"center"});return c.add(e),setTimeout(function(){c.remove(e)},500),xPosition=[],oPosition=[],gameStatus=!1,labels=[],boardFull=!1,TURN="X",void cloneProgress()}if(labels.forEach(function(e){setTimeout(function(){c.remove(e)},100)}),rectangles.forEach(function(e){e.occupied=!1}),"X"===TURN){xScore++,xScorePlaceholder.innerText=xScore,xScoreContainer.classList.add("animated"),xScoreContainer.classList.add("shake");var n=new fabric.Text("X WON!",{left:c.getCenter().left,top:c.getCenter().top,fill:"hotpink",fontSize:100,fontFamily:"Raleway",fontWeight:100,selectable:!1,originX:"center",originY:"center"});c.add(n),setTimeout(function(){xScoreContainer.className="",c.remove(n)},500)}else{oScore++,oScorePlaceholder.innerText=oScore,oScoreContainer.classList.add("animated"),oScoreContainer.classList.add("shake");var t=new fabric.Text("O WON!",{left:c.getCenter().left,top:c.getCenter().top,fill:"hotpink",fontSize:100,fontFamily:"Raleway",fontWeight:100,selectable:!1,originX:"center",originY:"center"});c.add(t),setTimeout(function(){oScoreContainer.className="",c.remove(t)},500)}return xPosition=[],oPosition=[],gameStatus=!1,labels=[],TURN="X",void cloneProgress()}function areWeDoneHere(e,n){return e.push(parseInt(n.id)),WIN.some(function(n){var t=void 0;if(e.length>3)t=divideThemInChunks(e);else{if(3!==e.length)return!1;t=_.chunk(e,3)}return t.map(function(e){return e.sort()}),t.some(function(e){return gameStatus=0==_.difference(n,e).length}),gameStatus}),gameStatus}function divideThemInChunks(e){var n=[];return[].concat(_toConsumableArray(Array(e.length).keys())).forEach(function(t){var i=[].concat(_toConsumableArray(e)),o=_.pull(i,i[t]);n.push(o)}),_.uniq(n)}function switchTurn(){TURN="X"===TURN?"O":"X"}function cloneProgress(){var e=progress,n=e.cloneNode(!0);e.parentNode.replaceChild(n,e),n.addEventListener("animationend",function(e){e.preventDefault(),switchTurn(),cloneProgress(),repaint()})}"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("service-worker.js").then(function(e){e.onupdatefound=function(){var n=e.installing;n.onstatechange=function(){switch(n.state){case"installed":navigator.serviceWorker.controller?console.log("New or updated content is available."):console.log("Content is now available offline!");break;case"redundant":console.error("The installing service worker became redundant.")}}}}).catch(function(e){console.error("Error during service worker registration:",e)})}),window.onresize=function(){location.reload()};var ismobile=navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i),PADDING=ismobile?5*window.outerWidth/100:window.outerWidth/100;canvas.style.padding=ismobile?"6%":"1%";for(var gameStatus=!1,xScorePlaceholder=document.querySelector(".xScore"),oScorePlaceholder=document.querySelector(".oScore"),boardFull=!1,xScore=0,oScore=0,labels=[],WIN=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],xPosition=[],oPosition=[],TURN="X",c=new fabric.Canvas("canvas",{width:window.innerWidth-2*PADDING,height:window.innerHeight-scorecard.offsetHeight-2.5*PADDING,selectable:!1}),boardProps={stroke:"#00bcd4",fill:"",strokeWidth:1,selectable:!1},height=canvas.clientHeight-PADDING,width=canvas.clientWidth-PADDING,oneThirdWidth=Math.floor(width/3),oneThirdHeight=Math.floor(height/3),rectangles=[],count=0,i=0;i<3;i++)for(var j=0;j<3;j++){var temp=new fabric.Rect({top:i*oneThirdHeight,left:j*oneThirdWidth,height:oneThirdHeight-2,width:oneThirdWidth-2,fill:"",stroke:"white",selectable:!1,id:(count++).toString(),occupied:!1});rectangles.push(temp)}rectangles.forEach(function(e){c.add(e)});var lineV1=new fabric.Line([oneThirdWidth-2,0,oneThirdWidth-2,height],boardProps),lineV2=new fabric.Line([2*oneThirdWidth-2,0,2*oneThirdWidth-2,height],boardProps),lineH1=new fabric.Line([0,oneThirdHeight-2,width,oneThirdHeight-2],boardProps),lineH2=new fabric.Line([0,2*oneThirdHeight-2,width,2*oneThirdHeight-2],boardProps);c.add(lineV1,lineV2,lineH1,lineH2),progress.style.animation="reduced 100000000s ease-in",progress.addEventListener("animationend",function(e){switchTurn(),cloneProgress(),repaint()}),startGame();